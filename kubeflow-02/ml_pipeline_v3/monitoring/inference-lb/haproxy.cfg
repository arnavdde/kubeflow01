global
    log stdout format raw local0
    maxconn 2048

defaults
    log     global
    mode    http
    option  httplog
    timeout connect 90s
    timeout client  60s
    timeout server  90s
    timeout check   10s

resolvers docker
    nameserver dns 127.0.0.11:53
    resolve_retries       3
    timeout retry         1s
    hold other           30s
    hold refused         30s
    hold nx              30s
    hold timeout         30s
    hold valid           10s

frontend inference_fe
    bind *:80
    default_backend inference_be

backend inference_be
    mode http
    balance leastconn
    option httpchk GET /healthz
    default-server rise 3 fall 5 inter 3s
    server-template srv 1-10 inference:8000 check resolvers docker resolve-prefer ipv4
